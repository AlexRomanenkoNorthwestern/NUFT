import websocket
import rel
import json

class binancews2():
    def __init__(self):
        pass

    def on_message(ws, message):
        print(message)
    
    def on_error(ws, error):
        print(error)

    def on_close(ws, close_status_code, close_msg):
        print("### closed ###")

    def on_open(ws):
        print("Opened connection")

    def main(self):
        websocket.enableTrace(True)
        ws = websocket.WebSocketApp("wss://stream.binance.com:9443/ws",
                                on_open=self.on_open,
                                on_message=self.on_message,
                                on_error=self.on_error,
                                on_close=self.on_close)
        
        ws.run_forever(dispatcher=rel)  # Set dispatcher to automatic reconnection
        ws.send(json.dumps({'method':'SUBSCRIBE','params':['btcusdt@ticker'],'id':1}))
        rel.signal(2, rel.abort)  # Keyboard Interrupt
        rel.dispatch()

bws2 = binancews2()
bws2.main()